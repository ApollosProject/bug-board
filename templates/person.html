{% extends "base.html" %}

{% block title %}{{ person_name|first_name }}{% endblock %}

{% block header_nav %}{% endblock %}

{% block content %}
      <div class="grid">
        <div>
          <article>
            <header>PRs Merged</header>
            <h1>{{ merged_prs }}</h1>
          </article>
        </div>
        <div>
          <article>
            <header>PRs Approved</header>
            <h1>{{ approved_prs }}</h1>
          </article>
        </div>
      </div>
      <article>
        <canvas id="platformChart"></canvas>
      </article>
      <h2>{{ 'Current Support Work' if on_call_support else 'Current Cycle Work' }}</h2>
      {% if open_current_cycle %}
      {% for project, issues in open_current_cycle.items() %}
      <details open>
        <summary>{{ project }}</summary>
        {% for issue in issues %}
        <div class="card">
          <article>
            <a href="{{ issue.url }}">{{ issue.title }}</a>
          </article>
        </div>
        {% endfor %}
      </details>
      {% endfor %}
      {% else %}
        <p>(Empty)</p>
      {% endif %}
      <h2>Other Work</h2>
      {% for project, issues in open_other.items() %}
      <details>
        <summary>{{ project }}</summary>
        {% for issue in issues %}
        <div class="card">
          <article>
            <a href="{{ issue.url }}">{{ issue.title }}</a>
          </article>
        </div>
        {% endfor %}
      </details>
      {% endfor %}
      <hr />
      <h2>Completed</h2>
      <form method="get" style="display:inline-block; margin-bottom: 0.5em;">
        <select name="days" onchange="this.form.submit()">
          <option value="1"  {{ 'selected' if days == 1 else '' }}>1d</option>
          <option value="7"  {{ 'selected' if days == 7 else '' }}>7d</option>
          <option value="30" {{ 'selected' if days == 30 else '' }}>30d</option>
        </select>
      </form>
      {% for project, issues in completed_by_project.items() %}
      <details>
        <summary>{{ project }}</summary>
        {% for issue in issues %}
        <div class="card">
          <article>
            <a href="{{ issue.url }}">{{ issue.title }}</a>
          </article>
        </div>
        {% endfor %}
      </details>
      {% endfor %}
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('platformChart');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [
        {% for platform in completed_by_platform %}
        '{{ platform }}',
        {% endfor %}
      ],
      datasets: [{
        label: 'Completed Issues',
        data: [
          {% for platform in completed_by_platform %}
          {{ completed_by_platform[platform] | length }},
          {% endfor %}
        ],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });
</script>
{% endblock %}
